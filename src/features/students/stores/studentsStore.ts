import { create } from "zustand";
import type { Student, StudentFormData, StudentsStore } from "../types/students.types";

// Mock data
const mockStudents: Student[] = [
  {
    id: 1,
    firstName: "Алишер",
    lastName: "Каримов",
    phone: "+998901234567",
    birthDate: "2005-03-15",
    gender: "male",
    parentName: "Каримов Бахтиёр",
    parentPhone: "+998901234568",
    branchId: 1,
    groupId: 1,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-01-15T10:00:00Z",
  },
  {
    id: 2,
    firstName: "Малика",
    lastName: "Рахимова",
    phone: "+998902345678",
    birthDate: "2006-07-22",
    gender: "female",
    parentName: "Рахимов Азиз",
    parentPhone: "+998902345679",
    branchId: 1,
    groupId: 1,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "Отличница",
    createdAt: "2024-01-20T10:00:00Z",
  },
  {
    id: 3,
    firstName: "Жасур",
    lastName: "Тошматов",
    phone: "+998903456789",
    birthDate: "2004-11-08",
    gender: "male",
    parentName: "Тошматова Дилноза",
    parentPhone: "+998903456790",
    branchId: 2,
    groupId: 2,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-02-01T10:00:00Z",
  },
  {
    id: 4,
    firstName: "Нигора",
    lastName: "Султанова",
    phone: "+998904567890",
    birthDate: "2005-05-30",
    gender: "female",
    parentName: "Султанов Камол",
    parentPhone: "+998904567891",
    branchId: 1,
    groupId: 1,
    languageId: 1,
    status: "frozen",
    photo: null,
    notes: "Временно заморожен - поездка",
    createdAt: "2024-02-10T10:00:00Z",
  },
  {
    id: 5,
    firstName: "Бобур",
    lastName: "Эргашев",
    phone: "+998905678901",
    birthDate: "2003-09-12",
    gender: "male",
    parentName: "Эргашев Рустам",
    parentPhone: "+998905678902",
    branchId: 2,
    groupId: 2,
    languageId: 1,
    status: "graduated",
    photo: null,
    notes: "Закончил курс B2",
    createdAt: "2023-06-15T10:00:00Z",
  },
  {
    id: 6,
    firstName: "Севара",
    lastName: "Мирзаева",
    phone: "+998906789012",
    birthDate: "2007-01-25",
    gender: "female",
    parentName: "Мирзаева Гулнора",
    parentPhone: "+998906789013",
    branchId: 1,
    groupId: null,
    languageId: 2,
    status: "active",
    photo: null,
    notes: "Новый студент, ожидает группу",
    createdAt: "2024-03-01T10:00:00Z",
  },
  {
    id: 7,
    firstName: "Шерзод",
    lastName: "Юлдашев",
    phone: "+998907890123",
    birthDate: "2005-08-18",
    gender: "male",
    parentName: "Юлдашев Фаррух",
    parentPhone: "+998907890124",
    branchId: 3,
    groupId: 3,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-01-25T10:00:00Z",
  },
  {
    id: 8,
    firstName: "Дилноза",
    lastName: "Хакимова",
    phone: "+998908901234",
    birthDate: "2006-04-10",
    gender: "female",
    parentName: "Хакимов Умид",
    parentPhone: "+998908901235",
    branchId: 1,
    groupId: 1,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-02-15T10:00:00Z",
  },
  {
    id: 9,
    firstName: "Азамат",
    lastName: "Норматов",
    phone: "+998909012345",
    birthDate: "2004-12-05",
    gender: "male",
    parentName: "Норматов Шухрат",
    parentPhone: "+998909012346",
    branchId: 2,
    groupId: 2,
    languageId: 1,
    status: "left",
    photo: null,
    notes: "Ушел по семейным обстоятельствам",
    createdAt: "2023-09-01T10:00:00Z",
  },
  {
    id: 10,
    firstName: "Мадина",
    lastName: "Абдуллаева",
    phone: "+998900123456",
    birthDate: "2005-06-20",
    gender: "female",
    parentName: "Абдуллаева Ферузa",
    parentPhone: "+998900123457",
    branchId: 3,
    groupId: 3,
    languageId: 2,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-02-20T10:00:00Z",
  },
  {
    id: 11,
    firstName: "Умид",
    lastName: "Расулов",
    phone: "+998911234567",
    birthDate: "2006-02-14",
    gender: "male",
    parentName: "Расулов Бахром",
    parentPhone: "+998911234568",
    branchId: 1,
    groupId: 1,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "",
    createdAt: "2024-03-05T10:00:00Z",
  },
  {
    id: 12,
    firstName: "Зарина",
    lastName: "Файзуллаева",
    phone: "+998912345678",
    birthDate: "2005-10-30",
    gender: "female",
    parentName: "Файзуллаев Ботир",
    parentPhone: "+998912345679",
    branchId: 2,
    groupId: 2,
    languageId: 1,
    status: "active",
    photo: null,
    notes: "Подготовка к IELTS",
    createdAt: "2024-01-10T10:00:00Z",
  },
];

let nextId = 13;

export const useStudentsStore = create<StudentsStore>((set) => ({
  students: mockStudents,
  selectedStudent: null,
  isLoading: false,
  error: null,

  fetchStudents: async () => {
    set({ isLoading: false });
  },

  createStudent: async (data: StudentFormData) => {
    const newStudent: Student = {
      id: nextId++,
      ...data,
      branchId: data.branchId || 1,
      photo: null,
      createdAt: new Date().toISOString(),
    };
    set((state) => ({
      students: [...state.students, newStudent],
    }));
  },

  updateStudent: async (id: number, data: StudentFormData) => {
    set((state) => ({
      students: state.students.map((s) =>
        s.id === id ? { ...s, ...data, branchId: data.branchId || s.branchId } : s
      ),
      selectedStudent: null,
    }));
  },

  deleteStudent: async (id: number) => {
    set((state) => ({
      students: state.students.filter((s) => s.id !== id),
    }));
  },

  setSelectedStudent: (student: Student | null) => {
    set({ selectedStudent: student });
  },

  clearError: () => {
    set({ error: null });
  },
}));
